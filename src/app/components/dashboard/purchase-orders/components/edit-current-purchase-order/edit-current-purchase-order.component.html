<form [formGroup]="form">
    <mat-card *ngIf="!error">
        <mat-card-header class="primary" style="padding:10px">
            <mat-icon style="font-size:20px">note_add</mat-icon>
            <span>
                ORDEN DE COMPRA
            </span>
            <div class="item-spacer"></div>

            <span class="icon-close-modal" (click)="closeDialog()">&#10008;</span>

        </mat-card-header>
        <mat-grid-list cols="12" rowHeight="90px">
            <mat-grid-tile [colspan]="colMedium" [rowspan]="1">
                <mat-form-field appearance="outline" floatLabel="always">
                    <mat-label>¿A DONDE ENVÍA?</mat-label>
                    <mat-select [formControl]="storeCtrl" (selectionChange)="setStore()" #singleSelect required>
                        <mat-option>
                            <ngx-mat-select-search placeholderLabel="Buscar..." [formControl]="storeFilterCtrl">
                            </ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let store of filteredStore | async" [value]="store">
                            {{store.name!}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </mat-grid-tile>
            <mat-grid-tile [colspan]="colMedium" [rowspan]="1">
                <mat-form-field appearance="outline" floatLabel="always">
                    <mat-label>COMENTARIOS</mat-label>
                    <textarea matInput formControlName="comments" rows="2"
                        (ngModelChange)="updateComments()"></textarea>
                </mat-form-field>
            </mat-grid-tile>
        </mat-grid-list>
        <div class="mat-elevation-z8">
            <div class="table-container-medium" style="margin:0px;">
                <div class="overlay-loading" *ngIf="loading">
                    <div class="spinner-wrapper">
                        <mat-spinner diameter="50" *ngIf="loading" class="spinner" color="primary"></mat-spinner>
                    </div>
                </div>
                <table mat-table [dataSource]="dataSourceProducts" matSort>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsProducts; sticky: true">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsProducts;">
                    </tr>

                    <ng-container matColumnDef="amount">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            CANTIDAD</th>
                        <td mat-cell *matCellDef="let item; let i = index;" style="width:15%">
                            <input class="custom-input" [ngModelOptions]="{standalone: true}" type="number"
                                [(ngModel)]="item.quantity" (ngModelChange)="updateValorsProduct(item)">
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="sub_total">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            TOTAL</th>
                        <td mat-cell *matCellDef="let item" style="width:10%">
                            {{item.total}}</td>
                    </ng-container>
                    <ng-container matColumnDef="description">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            DESCRIPCIÓN</th>
                        <td mat-cell *matCellDef="let item" style="width:20%">
                            {{item.description}}</td>
                    </ng-container>


                    <ng-container matColumnDef="type">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            TIPO</th>
                        <td mat-cell *matCellDef="let item" style="width:15%">
                            {{item.type == 1 ? 'PRODUCTO TERMINADO': 'MATERIA PRIMA'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="inventory">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            EXISTENCIA</th>
                        <td mat-cell *matCellDef="let item" style="width:15%">
                            {{item.inventory}}</td>
                    </ng-container>

                    <ng-container matColumnDef="provider">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            PROVEEDOR</th>
                        <td mat-cell *matCellDef="let item" style="width:15%">
                            {{item.provider}}</td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell class="primary" *matHeaderCellDef>
                            ACCIONES</th>
                        <td mat-cell *matCellDef="let item" style="width:10%; text-align: right;">

                            <a class="btnAction" style="color:var(--error)" (click)="deleteProduct(item)"
                                matTooltip="ELIMINAR PRODUCTO">
                                <mat-icon class="custom-size-animation">delete</mat-icon>
                            </a>
                        </td>
                    </ng-container>



                </table>

            </div>
        </div>

    </mat-card>
    <mat-card *ngIf="error" class="colorSecondary">

        <div class="error">
            <mat-icon style="font-size: 50px" aria-hidden="false">lock</mat-icon>
            <h1>{{error_msg}}</h1>
        </div>
    </mat-card>
</form>